@using Connapse.Core

<EditForm Model="@localSettings" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />

    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label">Strategy</label>
            <InputSelect @bind-Value="localSettings.Strategy" class="form-select">
                <option value="FixedSize">Fixed Size</option>
                <option value="Recursive">Recursive</option>
                <option value="Semantic">Semantic</option>
                <option value="DocumentAware">Document Aware</option>
            </InputSelect>
        </div>

        <div class="col-md-6">
            <label class="form-label">Max Chunk Size (tokens)</label>
            <InputNumber @bind-Value="localSettings.MaxChunkSize" class="form-control" />
        </div>

        <div class="col-md-6">
            <label class="form-label">Overlap (tokens)</label>
            <InputNumber @bind-Value="localSettings.Overlap" class="form-control" />
            <small class="form-text text-muted">Overlap between consecutive chunks</small>
        </div>

        <div class="col-md-6">
            <label class="form-label">Min Chunk Size (tokens)</label>
            <InputNumber @bind-Value="localSettings.MinChunkSize" class="form-control" />
        </div>

        <div class="col-md-6">
            <label class="form-label">Semantic Threshold</label>
            <InputNumber @bind-Value="localSettings.SemanticThreshold" class="form-control" step="0.1" min="0" max="1" />
            <small class="form-text text-muted">For semantic chunking (0.0-1.0)</small>
        </div>

        <div class="col-md-6">
            <div class="form-check mt-4">
                <InputCheckbox @bind-Value="localSettings.RespectDocumentStructure" class="form-check-input" id="respectStructure" />
                <label class="form-check-label" for="respectStructure">
                    Respect Document Structure
                </label>
                <small class="form-text text-muted d-block">Preserve headings and paragraphs</small>
            </div>
        </div>

        <div class="col-12 mt-4">
            <button type="submit" class="btn btn-primary me-2">
                <span class="bi-save me-1"></span> Save Changes
            </button>
            <button type="button" class="btn btn-secondary" @onclick="Reset">
                <span class="bi-arrow-counterclockwise me-1"></span> Reset
            </button>
        </div>
    </div>
</EditForm>

@code {
    [Parameter]
    public ChunkingSettings Settings { get; set; } = new();

    [Parameter]
    public EventCallback<ChunkingSettings> OnSave { get; set; }

    private ChunkingSettings localSettings = new();

    protected override void OnParametersSet()
    {
        localSettings = Settings with { };
    }

    private async Task HandleSubmit()
    {
        await OnSave.InvokeAsync(localSettings);
    }

    private void Reset()
    {
        localSettings = Settings with { };
    }
}
